<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <!-- Link preview -->
    <meta name="description" content="Visa Coffee Order Page">
    <meta name="keywords" content="visa,coffee,order">
    <meta property="og:image" content="img/logo_square.png" />
    <link rel="image_src" href="img/logo_square.png" />
    <!-- View port meta-->
    <meta name="viewport"
        content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width, user-scalable=no, minimal-ui" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="full-screen" content="yes" />
    <meta name="screen-orientation" content="portrait" />
    <!-- favicon -->
    <link rel="shortcut icon" href="img/favicon.ico" type="image/x-icon">
    <link rel="icon" href="img/favicon.ico" type="image/x-icon">
    <title>Visa Coffee Order Page</title>
    <!-- DATA -->
    <script>
        let classmates = [
            {
                "firstName": "Goriunova",
                "prefix": "Gorgeous"
            },
            {
                "firstName": "Charles",
                "prefix": "Champion"
            },
            {
                "firstName": "Juliana",
                "prefix": "Gentle"
            },
            {
                "firstName": "Marcia",
                "prefix": "Marvelous"
            },
            {
                "firstName": "Aline",
                "prefix": "Beautiful, beautiful, beautiful"
            },
            {
                "firstName": "Jessica",
                "prefix": "Joyful"
            },
            {
                "firstName": "Marco",
                "prefix": "Handsome"
            },
            {
                "firstName": "Mark",
                "prefix": "Muscular"
            },
            {
                "firstName": "Phyo Phyo",
                "prefix": "Playful"
            },
            {
                "firstName": "Alena",
                "prefix": "Awesome"
            },
            {
                "firstName": "Jimin",
                "prefix": "Charming"
            },
            {
                "firstName": "Jinny",
                "prefix": "Genuine"
            },
            {
                "firstName": "Hyeajin",
                "prefix": "Humble"
            },
            {
                "firstName": "Arlica",
                "prefix": "All-knowing"
            },
            {
                "firstName": "Tommy",
                "prefix": "Thoughtful"
            },
            {
                "firstName": "Izumi",
                "prefix": "Indulgent"
            },
            {
                "firstName": "Natsumi",
                "prefix": "Noble"
            },
            {
                "firstName": "Alice",
                "prefix": "Ageless"
            },
            {
                "firstName": "Kelly",
                "prefix": "Kindhearted"
            },
            {
                "firstName": "Trudy",
                "prefix": "Trustworthy"
            }
        ];
        let menu = [
            {
                "name": "Cappuccino"
            },
            {
                "name": "Caffè Latte"
            },
            {
                "name": "Iced Caffè Latte"
            },
            {
                "name": "Sweet Latte"
            },
            {
                "name": "Iced Sweet Latte"
            },
            {
                "name": "Americano"
            },
            {
                "name": "Iced Americano"
            },
            {
                "name": "Gibraltar"
            },
            {
                "name": "Caffè Mocha"
            },
            {
                "name": "Iced Caffè Mocha"
            },
            {
                "name": "Samra Latte"
            },
            {
                "name": "Iced Samra Latte"
            }];
    </script>
    <!-- CSS -->
    <style>
        @font-face {
            /* quicksand-regular - latin-ext_latin_vietnamese */
            font-family: "Quicksand";
            font-style: normal;
            font-weight: 400;
            src: url("font/Quicksand/quicksand-v15-latin-ext_latin_vietnamese-regular.eot");
            /* IE9 Compat Modes */
            src: local(""), url("font/Quicksand/quicksand-v15-latin-ext_latin_vietnamese-regular.eot?#iefix") format("embedded-opentype"),
                /* IE6-IE8 */
                url("font/Quicksand/quicksand-v15-latin-ext_latin_vietnamese-regular.woff2") format("woff2"),
                /* Super Modern Browsers */
                url("font/Quicksand/quicksand-v15-latin-ext_latin_vietnamese-regular.woff") format("woff"),
                /* Modern Browsers */
                url("font/Quicksand/quicksand-v15-latin-ext_latin_vietnamese-regular.ttf") format("truetype"),
                /* Safari, Android, iOS */
                url("font/Quicksand/quicksand-v15-latin-ext_latin_vietnamese-regular.svg#Quicksand") format("svg");
            /* Legacy iOS */
        }

        @font-face {
            /* quicksand-700 - latin-ext_latin_vietnamese */
            font-family: "Quicksand";
            font-style: normal;
            font-weight: 700;
            src: url("font/Quicksand/quicksand-v15-latin-ext_latin_vietnamese-700.eot");
            /* IE9 Compat Modes */
            src: local(""), url("font/Quicksand/quicksand-v15-latin-ext_latin_vietnamese-700.eot?#iefix") format("embedded-opentype"),
                /* IE6-IE8 */
                url("font/Quicksand/quicksand-v15-latin-ext_latin_vietnamese-700.woff2") format("woff2"),
                /* Super Modern Browsers */
                url("font/Quicksand/quicksand-v15-latin-ext_latin_vietnamese-700.woff") format("woff"),
                /* Modern Browsers */
                url("font/Quicksand/quicksand-v15-latin-ext_latin_vietnamese-700.ttf") format("truetype"),
                /* Safari, Android, iOS */
                url("font/Quicksand/quicksand-v15-latin-ext_latin_vietnamese-700.svg#Quicksand") format("svg");
            /* Legacy iOS */
        }

        html {
            height: 100vh;
            width: 100vw;
            position: fixed;
            overflow: hidden;
            touch-action: manipulation;
            outline: 0;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
            font-family: "Quicksand", sans-serif;
        }

        html,
        body {
            height: 100vh;
            width: 100vw;
            position: fixed;
            overflow: hidden;
            touch-action: manipulation;
            outline: 0;
            padding: 0;
            margin: 0;
            font-size: 0px;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
            color: var(--color-text-1);
            background-color: var(--color-bg-1);
            font-family: "Quicksand", sans-serif;
        }

        p {
            margin: 0px;
        }

        div.general-content-outer {
            width: 100vw;
            height: 100vh;
            overflow: auto;
            position: absolute;
            background-color: #1ab9a7;
        }

        div.content {
            width: 320px;
            background-color: #fff;
            top: 20px;
            position: absolute;
            left: 50%;
            transform: translate(-50%, 0%);
            box-shadow: 0 0 5px #777;
            box-sizing: border-box;
            display: grid;
            padding: 10px;
        }

        span.text {
            font-size: 20px;
            padding-top: 10px;
            padding-bottom: 10px;
            display: block;
        }

        span.text-small {
            font-size: 14px;
            padding-top: 5px;
            padding-bottom: 5px;
            display: block;
        }

        input.text-input {
            background: #fbfbfb;
            border: 2px solid #d5d5d5;
            border-radius: 0;
            -webkit-appearance: none;
            -webkit-border-radius: 0;
            -moz-border-radius: 0;
            -webkit-box-shadow: none;
            box-shadow: none;
            -webkit-transition: none;
            color: #999;
            font-family: 'Quicksand';
            height: 60px;
            font-size: 20px;
            margin-top: 10px;
            margin-bottom: 10px;
            padding: 6px 10px;
            display: block;
            width: 100%;
            box-sizing: border-box;
        }

        div.input-name-outer {
            position: relative;
        }

        div.name-selection {
            position: absolute;
            display: grid;
            top: 80px;
            width: 100%;
            z-index: 10000 !important;
            background: #fff;
            box-sizing: border-box;
            border-radius: 4px;
        }

        span.name-not-found {
            color: red;
            box-sizing: border-box;
            padding-left: 10px;
            padding-right: 10px;
            display: block;
        }

        .name-border {
            border-radius: 4px;
            border: 2px solid black;
        }

        div.found-name {
            font-size: 20px;
            padding: 10px;
            cursor: pointer;
            background-color: #fff;
        }

        div.found-name:hover {
            background-color: #00aeef;
        }

        .bottom-border {
            border-bottom: 1px solid grey;
        }

        span.selected-classmate {
            display: block;
        }

        span.change-selection {
            font-size: 12px;
            color: #00aeef;
            text-decoration: underline;
            cursor: pointer;
            justify-self: self-end;
        }

        div.show-name {
            display: grid;
            grid-template-columns: 1fr;
        }

        div.order {
            display: none;
            position: relative;
        }

        div.coffee-selection {
            position: absolute;
            display: none;
            top: 195px;
            width: 100%;
            height: 350px;
            z-index: 10000 !important;
            background: #fff;
            box-sizing: border-box;
            border-radius: 4px;
            border: 2px solid black;
            overflow: auto;
        }

        div.coffee-choice {
            font-size: 20px;
            padding: 10px;
            cursor: pointer;
            background-color: #fff;
        }

        .coffee-choice:hover {
            background-color: #00aeef;
        }

        div.button {
            -webkit-border-radius: 3px;
            -moz-border-radius: 3px;
            border-radius: 3px;
            border: 2px solid #282828;
            color: #282828;
            padding: 7px 20px;
            -moz-transition: background .5s ease;
            -webkit-transition: background .5s ease;
            -o-transition: background .5s ease;
            background-color: #fff;
            font-size: 20px;
            width: 100px;
            text-align: center;
            cursor: pointer;
            margin-left: auto;
            margin-right: auto;
            display: none;
        }

        .button:hover {
            background-color: #00aeef;
        }

        div.confirmation {
            display: none;
            grid-template-columns: 1fr;
        }

        div.overlay {
            width: 100vw;
            height: 100vh;
            position: relative;
            display: none;
            z-index: 999999 !important;
            background-color: rgba(90, 90, 90, 0.5);
        }
    </style>
    <!-- SCRIPT -->
    <script>
        window.onload = function () {
            let a = "";
            for (let i = 0; i < classmates.length; i++) {
                a = a + classmates[i].firstName + " ";
            }
            console.log(a);

            let divMenuChoices = document.getElementById('divCoffeeSelection');
            for (let i = 0; i < menu.length; i++) {
                let divChoice = document.createElement('div');
                divChoice.classList.add('coffee-choice');
                divChoice.innerText = menu[i].name;
                divChoice.onclick = function () {
                    selectCoffeeChoice(menu[i].name);
                };
                divMenuChoices.appendChild(divChoice);
                if (i < menu.length - 1) {
                    divChoice.classList.add('bottom-border');
                }
            }
        };

        function nameInputChange(event) {
            let inputText = event.srcElement.value.trim().toUpperCase();
            if (inputText == "") {
                showFoundClassmates(null);
                return;
            }
            let foundClassmates = [];
            let nameRe = new RegExp("^" + inputText);
            for (let i = 0; i < classmates.length; i++) {
                let classmate = classmates[i];
                if (classmate.firstName.toUpperCase().match(nameRe)) {
                    foundClassmates.push(classmate);
                }
            }
            showFoundClassmates(foundClassmates);
        };

        function showFoundClassmates(foundClassmates) {
            let divFoundNames = document.getElementById('divFoundNames');
            let divNameNotFound = document.getElementById('divNameNotFound');
            divFoundNames.innerHTML = "";
            if (foundClassmates == null) {
                divFoundNames.style.display = 'none';
                divNameNotFound.style.display = 'none';
                return;
            }
            if (foundClassmates.length < 1) {
                divFoundNames.style.display = 'none';
                divNameNotFound.style.display = 'block';
                return;
            }
            divFoundNames.style.display = 'block';
            divNameNotFound.style.display = 'none';
            for (let i = 0; i < foundClassmates.length; i++) {
                let divName = document.createElement("div");
                divName.classList.add("found-name");
                divName.innerText = foundClassmates[i].firstName;
                divFoundNames.appendChild(divName);
                if (i < foundClassmates.length - 1) {
                    divName.classList.add("bottom-border");
                }
                divName.onclick = function () {
                    showChosenClassmate(foundClassmates[i]);
                };
            }
        }

        function showInputNameOuter() {
            document.getElementById('inputName').value = '';
            document.getElementById('spanShowName').setAttribute('chosen', '');
            document.getElementById('spanShowName').innerHTML = '';
            document.getElementById('divInputNameOuter').style.display = 'block';
            document.getElementById('divShowName').style.display = 'none';
            document.getElementById('divOrder').style.display = 'none';
            document.getElementById('divFoundNames').style.display = 'none';
            document.getElementById('divNameNotFound').style.display = 'none';
            resetCoffeeChoice();
            document.getElementById('divConfirmation').style.display = 'none';
            document.getElementById('inputName').focus();
        }

        function hideInputNameOuter() {
            document.getElementById('divFoundNames').style.display = 'none';
            document.getElementById('divNameNotFound').style.display = 'none';
            document.getElementById('divFoundNames').innerHTML = '';
            document.getElementById('divInputNameOuter').style.display = 'none';
            document.getElementById('divShowName').style.display = 'grid';
            document.getElementById('divOrder').style.display = 'block';
            document.getElementById('divConfirmation').style.display = 'none';
            resetCoffeeChoice();
        };

        function showChosenClassmate(classmate) {
            hideInputNameOuter();
            document.getElementById('spanShowName').innerHTML = `Hello, <b>${classmate.prefix} ${classmate.firstName}</b>!`;
            document.getElementById('spanShowName').setAttribute('chosen', classmate.firstName);
        };

        function showCoffeeChoices() {
            document.getElementById('divCoffeeSelection').style.display = 'block';
        }

        function selectCoffeeChoice(coffeeName) {
            document.getElementById('divCoffeeSelection').style.display = 'none';
            document.getElementById('inputCoffee').value = coffeeName;
            document.getElementById('divConfirm').style.display = 'block';
        }

        function resetCoffeeChoice() {
            document.getElementById('divCoffeeSelection').style.display = 'none';
            document.getElementById('inputCoffee').value = '';
            document.getElementById('divConfirm').style.display = 'none';
        }

        function showConfirmation(coffeeName) {
            resetCoffeeChoice();
            document.getElementById('divOrder').style.display = 'none';
            let article = 'a';
            if (coffeeName[0] == 'A' || coffeeName[0] == 'I') {
                article = 'an';
            }
            document.getElementById('spanConfirmation').innerHTML = `You ordered ${article} <b>${coffeeName}</b>. An excellent choice!`;
            document.getElementById('divConfirmation').style.display = 'grid';
        };

        function changeOrder() {
            resetCoffeeChoice();
            document.getElementById('divConfirmation').style.display = 'none';
            document.getElementById('divOrder').style.display = 'block';
        };

        async function confirmChoice() {
            document.getElementById('divOverlay').style.display = 'block';
            let data = {
                name: document.getElementById('spanShowName').getAttribute('chosen'),
                coffee: document.getElementById('inputCoffee').value,
            };
            let response = await sendToBackend('save', data);
            if (!response.success) {
                alert(`Error ${response.code}.\nPlease refresh and try again!`);
                return;
            }
            showConfirmation(response.result.coffee);
            document.getElementById('divOverlay').style.display = 'none';
        };

        function sendToBackend(webPart, dataJson) {
            let url = "https://capsulestudio.com.vn/api_visacoffee/" + webPart;
            return new Promise(function (resolve, reject) {
                var xmlhttp = new XMLHttpRequest();
                xmlhttp.onreadystatechange = function () {
                    if (this.readyState === 4) {
                        if (this.status === 200) {
                            parseJSON(this['response'])
                                .then(function (parseResult) {
                                    let result = parseResult.result;
                                    if (result != 0) {
                                        resolve({
                                            success: false,
                                            code: result,
                                        });
                                    } else {
                                        resolve({
                                            success: true,
                                            result: parseResult,
                                        });
                                    }
                                })
                                .catch(function () {
                                    resolve({
                                        success: false,
                                        code: 1, // cannot parse response JSON
                                    });
                                });
                        } else {
                            resolve({
                                success: false,
                                code: this.status,
                            });
                        }
                    }
                }
                xmlhttp.onerror = function (xmlhttpErr) {
                    reject(xmlhttpErr);
                }
                let params = '';
                for (let key in dataJson) {
                    if (dataJson.hasOwnProperty(key)) {
                        params = params + key + '=' + dataJson[key] + '&';
                    }
                }
                params = params.slice(0, -1);
                xmlhttp.open('POST', url, true);
                xmlhttp.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                xmlhttp.setRequestHeader('cache', 'no-cahce');
                xmlhttp.send(params);
            });
        };

        function parseJSON(input) {
            return new Promise(function (resolve, reject) {
                let jsonRes = JSON.parse(input);
                if (jsonRes.success) {
                    resolve(jsonRes);
                } else {
                    reject(jsonRes);
                }
            });
        };
    </script>
</head>

<body>
    <div class="general-content-outer">
        <div id="divOverlay" class="overlay"></div>
        <div class="top-area"></div>
        <div class="content">
            <span class="text">Thank you for voting! As a token of appreciation, please have a coffee from <b>Blue
                    Bottle</b>!</span>
            <div class="input-name-outer" id="divInputNameOuter">
                <input type="text" id="inputName" class="text-input" placeholder="Type & select your name!"
                    onkeyup="nameInputChange(event)">
                <div id="divNameSelection" class="name-selection">
                    <div id="divFoundNames" class='name-border' style="display: none;"></div>
                    <div id="divNameNotFound" style="display: none;">
                        <span class="text name-not-found name-border">Cannot find anyone!</span>
                    </div>
                </div>
            </div>
            <div id="divShowName" class="show-name" style="display: none;">
                <span id="spanShowName" class="text selected-classmate" chosen=""></span>
                <span class="change-selection" onclick="showInputNameOuter()">This is not me!</span>
            </div>
            <div id="divOrder" class="order">
                <span class="text">Please order a coffee of your choice!</span>
                <span class="text-small">(★) If you do not or cannot make a choice, a Caffè Latte will be chosen on your
                    behalf.</span>
                <span class="text-small">(★★) In the unfortunate event your particular order cannot be fullfilled, it
                    will be
                    replaced with a Caffè Latte.</span>
                <input type="text" id="inputCoffee" class="text-input" style='cursor: pointer;'
                    placeholder="Click and select a coffee!" onclick="showCoffeeChoices()" readonly>
                <div id="divCoffeeSelection" class="coffee-selection"></div>
                <div id="divConfirm" class="button" onclick="confirmChoice()">Confirm</div>
            </div>
            <div id="divConfirmation" class="confirmation">
                <span id='spanConfirmation' class="text"></span>
                <span class="change-selection" onclick="changeOrder()">I change my
                    mind</span>
            </div>
        </div>
    </div>
</body>

</html>